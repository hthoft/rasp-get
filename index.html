<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Website</title>
    <!-- Link Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <style>
      /* Remove margin and padding from body */
      body {
        margin: 0;
        padding: 0;
      }
      #splashContainer {
        position: relative;
        display: inline-block;
      }
      #overlayText {
        position: absolute;
        top: 75%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 3rem;
        font-weight: bold;
        z-index: 2;
      }
      #nextContainer,
      #printQRContainer,
      #vaegQRContainer,
      #settingsContainer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 800px;
        height: 480px;
        background-image: url("maprova-bg.png");
        width: 800px;
        height: 480px;
        background-size: cover;
        background-position: center;
        text-align: center;
        padding-top: 20px;
        z-index: 1; /* Ensure it appears above other elements */
      }
      #buttonContainer {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 20px;
      }

      #buttonContainer2 {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: nowrap;
      }
      .btn-large {
        width: 300px;
        height: 200px;
        font-size: 1.5rem;
      }
      #settingsIcon {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 50px;
        height: 50px;
        cursor: pointer;
      }
      h2,
      h1 {
        margin: 10px 0;
        color: white;
      }

      /* Fullscreen scrollable list container */
      .list-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 800px;
        height: 480px;
        background-color: rgba(255, 255, 255, 0.95);
        z-index: 10;
        overflow-y: scroll;
        padding: 20px;
      }

      .list-item {
        font-size: 1.8rem;
        padding: 15px;
        border-bottom: 1px solid #ccc;
        cursor: pointer;
      }

      .list-item:hover {
        background-color: #f0f0f0;
      }

      h2,
      h1 {
        margin: 10px 0;
        color: white;
      }

      /* Disable Vælg Job button when no project is selected */
      #selectJobBtn:disabled {
        background-color: #cccccc;
        border-color: #cccccc;
      }

      /* Styles for the title displaying selected project and job */
      .selected-entity {
        margin-top: 20px;
        font-weight: bold;
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="splashContainer">
      <a id="splashLink" href="#">
        <img
          id="splashImage"
          src="splash.png"
          alt="Splash Image"
          width="800"
          height="480"
        />
        <div id="overlayText">START</div>
      </a>
    </div>

    <div id="nextContainer">
      <img id="settingsIcon" src="cog.png" alt="Settings" />
      <img
        src="dark-logo.png"
        alt="MAPROVA Logo"
        class="mt-5"
        width="250"
        style="filter: invert(1)"
      />

      <div id="buttonContainer">
        <button
          type="button"
          id="printQR"
          class="btn btn-danger btn-large fs-1 fw-bolder shadow"
          style="
            border-radius: 1.5rem;
            background-color: #04cf5c;
            border-color: #04cf5c;
          "
        >
          Print QR
        </button>
        <button
          type="button"
          id="selectQR"
          class="btn btn-light btn-large fs-1 fw-bolder shadow"
          style="border-radius: 1.5rem"
        >
          Vælg QR
        </button>
      </div>
      <div id="selectedEntity">
        <h2 class="mt-4 fw-light">Vælg projekt</h2>
        <h1 class="fw-bolder">...</h1>
      </div>
    </div>
    <!-- New containers for additional windows -->
    <div id="printQRContainer" style="display: none">
      <h2 class="mt-3 fw-light mb-0">23024 - CPH Village</h2>
      <h1 class="fw-bolder mt-0 mb-3">ME.01.02.03</h1>
      <div
        id="countContainer"
        class="d-flex justify-content-center align-items-center"
      >
        <button id="minusBtn" class="btn btn-lg btn-light px-5 py-3 shadow">
          <img src="qrcode-remove.svg" alt="Minus" width="100" height="100" />
        </button>
        <div
          id="countDisplay"
          class="form-control text-center mx-4 fw-bold shadow"
          style="width: 110px; font-size: 80px; pointer-events: none"
        >
          1
        </div>
        <button id="plusBtn" class="btn btn-lg btn-light px-5 py-3 shadow">
          <img src="qrcode-plus.svg" alt="Plus" width="100" height="100" />
        </button>
      </div>

      <div id="actionButtons" class="mt-3 text-center">
        <button
          id="cancelBtn"
          class="btn btn-danger btn-lg mx-2 fw-bolder text-black shadow"
        >
          <img
            src="printer-pos-cancel-outline.svg"
            alt="Plus"
            width="100"
            height="100"
          /><br />
          Afbryd
        </button>
        <button
          id="printBtn"
          class="btn btn-lg mx-2 fw-bolder text-black shadow w-50"
          style="background-color: #04cf5c"
        >
          <img
            src="printer-pos-check-outline.svg"
            alt="Plus"
            width="100"
            height="100"
          /><br />
          Print QR
        </button>
      </div>
    </div>

    <div id="vaegQRContainer">
      <h2 class="fw-light" id="projectEntity">Vælg projekt</h2>
      <h1 class="fw-bolder" id="jobEntity">Vælg QR Code</h1>

      <div id="buttonContainer" class="row">
        <button
          type="button"
          id="selectProjectBtn"
          class="btn btn-large btn-info fs-1 fw-bolder shadow"
          style="border-radius: 1.5rem"
        >
          Vælg Sag
        </button>
        <button
          type="button"
          id="selectJobBtn"
          class="btn btn-large btn-light fs-1 fw-bolder shadow"
          style="border-radius: 1.5rem"
          disabled
        >
          Vælg Job
        </button>
      </div>

      <div class="mt-5">
        <!-- Button to select the job -->
        <!-- Button to cancel -->
        <button
          id="cancelJobBtn"
          class="btn btn-danger btn-lg fw-bolder shadow"
          style="border-radius: 1.5rem"
        >
          <i class="mdi mdi-cancel"></i> Afbryd
        </button>
      </div>
    </div>

    <div id="projectListContainer" class="list-container">
      <h3 class="text-center mb-4">Vælg Projekt</h3>
      <div id="projectList"></div>
    </div>

    <!-- Scrollable List for Jobs -->
    <div id="jobListContainer" class="list-container">
      <h3 class="text-center mb-4">Vælg Job</h3>
      <div id="jobList"></div>
    </div>

    <div id="settingsContainer" style="display: none">
      <h1>Indstillinger Window</h1>
      <!-- Content for Indstillinger Window -->
    </div>

    <!-- Optional: Include Bootstrap JS (if needed) -->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const splashLink = document.getElementById("splashLink");
        const splashImage = document.getElementById("splashImage");
        const overlayText = document.getElementById("overlayText");
        const nextContainer = document.getElementById("nextContainer");
        const printQRContainer = document.getElementById("printQRContainer");
        const vaegQRContainer = document.getElementById("vaegQRContainer");
        const settingsContainer = document.getElementById("settingsContainer");

        let countdownTimer;
        const countdownTime = 10000; // 10 seconds in milliseconds

        function resetTimer() {
          clearTimeout(countdownTimer);
          countdownTimer = setTimeout(function () {
            // Reset to splash page
            nextContainer.style.display = "none";
            printQRContainer.style.display = "none";
            vaegQRContainer.style.display = "none";
            settingsContainer.style.display = "none";
            splashContainer.style.display = "block";

            splashImage.style.display = "block";
            overlayText.style.display = "block";
          }, countdownTime);
        }

        splashLink.addEventListener("click", function (event) {
          event.preventDefault();
          splashImage.style.display = "none";
          overlayText.style.display = "none";
          nextContainer.style.display = "block";
          resetTimer();
          getAllProjects(); // Fetch projects when the window is opened
        });

        document
          .querySelector("#selectQR")
          .addEventListener("click", function () {
            vaegQRContainer.style.display = "block";
            nextContainer.style.display = "none";
            resetTimer();
            getAllProjects(); // Fetch projects when the window is opened
          });

        document
          .getElementById("settingsIcon")
          .addEventListener("click", function () {
            settingsContainer.style.display = "block";
            nextContainer.style.display = "none";
            resetTimer();
          });

        document
          .getElementById("cancelJobBtn")
          .addEventListener("click", function () {
            vaegQRContainer.style.display = "none";
            nextContainer.style.display = "block";
            resetTimer();
          });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const selectProjectBtn = document.getElementById("selectProjectBtn");
        const selectJobBtn = document.getElementById("selectJobBtn");
        const projectListContainer = document.getElementById(
          "projectListContainer"
        );
        const jobListContainer = document.getElementById("jobListContainer");
        const projectList = document.getElementById("projectList");
        const jobList = document.getElementById("jobList");
        const selectedEntity = document.getElementById("selectedEntity");
        const projectEntity = document.getElementById("projectEntity");
        const jobEntity = document.getElementById("jobEntity");

        let selectedProject = null;
        let selectedJob = null;

        // Function to reset display
        function resetDisplay() {
          projectListContainer.style.display = "none";
          jobListContainer.style.display = "none";
        }

        // Fetch and display all projects in a scrollable list
        function getAllProjects() {
          $.ajax({
            url: "http://127.0.0.1:5000/api/projects", // Fetch from local Flask API
            type: "GET",
            dataType: "json",
            success: function (projects) {
              projectList.innerHTML = "";
              projects.forEach(function (project) {
                const projectItem = document.createElement("div");
                projectItem.classList.add("list-item");
                projectItem.textContent = `${project.project_id} - ${project.project_title}`;
                projectItem.onclick = function () {
                  selectedProject = {
                    id: project.id,
                    title: project.project_title,
                  };
                  localStorage.setItem(
                    "selectedProject",
                    JSON.stringify(selectedProject)
                  );
                  console.log("Selected project:", selectedProject);
                  updateSelectedEntity();
                  projectEntity.textContent = project.project_title;
                  selectJobBtn.disabled = false; // Enable the job button
                  resetDisplay();
                };
                projectList.appendChild(projectItem);
              });
            },
            error: function (xhr, status, error) {
              console.error("Error fetching projects:", error);
            },
          });
        }

        // Fetch and display jobs for the selected project
        function getJobsForProject() {
          const projectId = selectedProject.id;
          $.ajax({
            url: `http://127.0.0.1:5000/api/jobs/${projectId}`, // Fetch from local Flask API
            type: "GET",
            dataType: "json",
            success: function (jobs) {
              jobList.innerHTML = "";
              jobs.forEach(function (job) {
                const jobItem = document.createElement("div");
                jobItem.classList.add("list-item");
                jobItem.textContent = job.job_title;
                jobItem.onclick = function () {
                  selectedJob = { id: job.id, title: job.job_title };
                  localStorage.setItem(
                    "selectedEntity",
                    JSON.stringify({
                      project: selectedProject,
                      job: selectedJob,
                    })
                  );
                  updateSelectedEntity();
                  resetDisplay();
                };
                jobList.appendChild(jobItem);
              });
            },
            error: function (xhr, status, error) {
              console.error("Error fetching jobs:", error);
            },
          });
        }

        // Update the display to show the selected project and job
        function updateSelectedEntity() {
          const entity =
            JSON.parse(localStorage.getItem("selectedEntity")) || {};
          const projectTitle = entity.project?.title || "Ingen projekt valgt";
          const jobTitle = entity.job?.title || "Ingen job valgt";
          selectedEntity.innerHTML = `
                                <h2 class="mt-4 fw-light">${projectTitle}</h2>
                                <h1 class="fw-bolder">${jobTitle}</h1>
                            `;
          projectEntity.textContent = projectTitle;
          jobEntity.textContent = jobTitle;
        }

        // Event listener for the project button
        selectProjectBtn.addEventListener("click", function () {
          projectListContainer.style.display = "block";
          getAllProjects();
        });

        // Event listener for the job button
        selectJobBtn.addEventListener("click", function () {
          if (selectedProject) {
            jobListContainer.style.display = "block";
            getJobsForProject();
          }
        });

        // Initialize selected project and job if already in localStorage
        updateSelectedEntity();
      });
    </script>
  </body>
</html>
